"use strict";function _interopDefault(e){return e&&"object"==typeof e&&"default"in e?e.default:e}var lodash=require("lodash"),EventEmitter=_interopDefault(require("events")),Promise=_interopDefault(require("bluebird"));const symbolLift=Symbol("_lift"),SymbolCheckMiddleware=Symbol("_checkMiddleware");process.on("uncaughtException",e=>{console.error("uncaughtException:",e),process.exit(1)}),process.on("unhandledRejection",(e,t)=>{console.log("Unhandled Rejection at:",t,"reason:",e),process.exit(1)});class Ofa2 extends EventEmitter{constructor(e,t){if(super(),this.options=t||{},this.middlewares=[],!e)throw new Error("need projectPath param");this.projectPath=e,this.init()}init(){this.environment=(process.env.NODE_ENV||"development").trim(),this.promise=Promise.resolve(),this.config={},this.model={},this.global={},this.graphql={},this.options.alias?global[this.options.alias]=this:global.framework=this,global.logger=console,global.logger.trace=global.logger.log,global.logger.debug=global.logger.log}use(e){let t;if(lodash.isFunction(e))t=e;else{if(!lodash.isString(e))throw new Error("middleware should be string or function");try{t=require(`ofa2-${e}`)}catch(e){console.warn(e),process.exit(1)}}return this.middlewares.push(t.default?t.default:t),this}async[SymbolCheckMiddleware](e){await Promise.each(this.middlewares,t=>{if(lodash.isFunction(t[e]))return t[e].call(this)}),this.emit(`${e}ed`)}async[symbolLift](){await Promise.each(this.middlewares,e=>lodash.isFunction(e)?e.call(this):lodash.isFunction(e.lift)?e.lift.call(this):void 0),this.emit("lifted")}lift(){return this.promise=this.promise.then(()=>{this[symbolLift]()}),this}listen(){return this.promise=this.promise.then(()=>this[SymbolCheckMiddleware]("listen")),this}lower(){return this.promise=this.promise.then(()=>this[SymbolCheckMiddleware]("lower")),this}}module.exports=Ofa2;
//# sourceMappingURL=bundle.cjs.js.map
